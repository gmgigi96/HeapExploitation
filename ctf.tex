\section{CTF}
Vediamo ora l'applicazione di tre attacchi ad heap descritti nella precedente sezione, \emph{fastbin dup into stack}, \emph{unsafe unlink} e \emph{house of spirit}, con tre CTF, \emph{Babyheap} contenuta in \emph{0ctf Quals 2017}, \emph{stkof} di \emph{HITCON CTF 2014} ed \emph{Oreo} di \emph{hack.lu CTF 2014}.
In tutti e tre gli eseguibili è stata utilizzata la versione 2.25 della glibc, quindi non avente la \verb+tcache+.

I tre binari sono \verb+stripped+, sono stati quindi eliminati tutti i simboli di debugging. Inoltre è stato studiato il codice assembly x86-64 mediante il tool \emph{Ghidra}\cite{ghidra}, che oltre a fornire un disassemblatore, fornisce un decompilatore che produce un codice C-like di ottima qualità.

Per uno studio dell'heap a tempo di esecuzione è stato utilizzato \emph{PwnDBG}, un debugger che espande le funzionalita di GDB, introducendo una serie di comandi utili per le CTF di categoria \emph{pwn}, in particolare le seguenti, utili per le pwn su heap:
\begin{itemize}
	\item \verb+heapinfo+: mostra alcune informazioni sull'heap, per tutti i thread
	\item \verb+fastbins+: mostra tutti i chunk contenuti in tutti i fastbin
	\item \verb+smallbins+: come il precedente, ma per i smallbin
	\item \verb+largebins+: come il precedente, ma per i largebin
	\item \verb+unsortedbin+: come il precedente, ma per l'unsorted bin
	\item \verb+tcache+: come il precedente, ma per le tcache
\end{itemize}

Un ulteriore tool per l'analisi dell'heap è \verb+HeapInspector+\cite{inspectpy}, scritto in Python, che consente di ispezionare il contenuto dell'heap e di tutti i bin, fornendo allo script il PID del processo che si vuole analizzare. Utile quando non sono disponibili i simboli di debugging nella libc, per cui i comandi per l'heap di PwnDBG potrebbero non funzionare.

Gli exploit sono stati scritti in Python2.7, utilizzando la libreria \emph{pwntools}~\cite{pwntool}, che ha una serie di strumenti utili per interagire con i processi, ed in generale per la scrittura di exploit.

Mentre in questo capitolo è spiegato passo passo l'exploit scritto per le challenge scelte, gli exploit integrali sono riportati nel Capitolo~\ref{cap:exploit}.
\input{ctf_babyheap}

\input{ctf_stkof}

\input{ctf_oreo}
